<!DOCTYPE html>
<html lang="en" >
<head>
	<script src="https://sdk.amazonaws.com/js/aws-sdk-2.169.0.min.js"></script>

  <meta charset="UTF-8">
  <title>Your PWA</title>
      <style>
      @import url(https://fonts.googleapis.com/css?family=Exo:100,200,400);
			@import url(https://fonts.googleapis.com/css?family=Source+Sans+Pro:700,400,300);

body{
	margin: 0;
	padding: 0;
	background: #fff;

	color: #fff;
	font-family: Arial;
	font-size: 12px;
}

.body{
	position: absolute;
	top: -20px;
	left: -20px;
	right: -40px;
	bottom: -40px;
	width: auto;
	height: auto;
	background-image: url('img/background-2.jpg');
	background-size: cover;
	z-index: 0;
}

.grad{
	position: absolute;
	top: -20px;
	left: -20px;
	right: -40px;
	bottom: -40px;
	width: auto;
	height: auto;
	background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(0,0,0,0)), color-stop(100%,rgba(0,0,0,0.65))); /* Chrome,Safari4+ */
	z-index: 1;
	opacity: 0.7;
}

.header{
	position: fixed;
	top: calc(1%);
	left: calc(30%);
	z-index: 2;
}

.header div{
	float: center;
	color: #fff;
	font-family: 'Exo', sans-serif;
	font-size: 4em;
	font-weight: 400;
	letter-spacing: 2px;
}

.sub-header{
	float: center;
	color: #fff;
	font-family: 'Exo', sans-serif;
	font-size: 2.5em;
	font-weight: 200;
	position:absolute;
	left: calc(30%);
}

.header div span{
	color: #5379fa !important;
}

.personalPage{
	position: absolute;
	top: calc(25%);
	left: calc(15%);
	z-index: 2;
}

.niceArea{
	font-family: 'Exo', sans-serif;
	font-size: 22px;
	font-weight: 400;
	color: White;

	background: transparent;
	user-select: none;
	outline:0px !important;
    -webkit-appearance:none;
	border: 0 none;
	height: 20em;
	width: 35em;
}

.semi-transparent-button {
  display: block;
  box-sizing: border-box;
  margin: 0 auto;
  padding: 8px;
  width: 80%;
  height: 80%;
  max-height: 3em;
  max-width: 10em;
  background: #fff; background: rgba(255, 255, 255, 0.5);
  border-radius: 8px;
  color: black;
  font-weight: 700;
  font-size: 18px;
  text-align: center;
  letter-spacing: 1px;
  transition: all 0.3s ease-out;

}

.less-button{
	position: fixed;
	top: calc(25%);
	right: calc(25%);
}

.more-button{
	position: fixed;
	top: calc(35%);
	right: calc(25%);
}

.location-button{
	position: fixed;
	top: calc(45%);
	right: calc(25%);
}

.logout{
	position: fixed;
	top: calc(60%);
	right: calc(25%);
}

	</style>

</head>

<!-- Main Page -->
<body>
  <div class="body"></div>
		<div class="grad"></div>
		<div class="header">
			<div>P<span>ersonalized </span>W<span>eather</span> A<span>ssistant</span></div>
			<h4 id='Welcome' class="sub-header"></div>
		</div>
		<br>
		<div class="personalPage">
			<textarea readonly rows="50" columns="50" class="niceArea" id="display">
				San_Franciso: 52.4 Degrees
				Los_Angeles: 88 Degrees
			</textarea>

			<input type="button" class="semi-transparent-button more-button" value="More Layers" onClick="tooHigh()">
			<input type="button" class="semi-transparent-button less-button" value="Less Layers" onClick="tooLow()">
			<input type="button" class="semi-transparent-button logout" value="Log Out" onClick="logOut()">
			<input type="button" class="semi-transparent-button location-button" value="Switch Location" onClick="switchLocation()">
			
			<!-- System scripts scripts -->
			<script>
				// Initialize the Amazon Cognito credentials provider
				AWS.config.update({
    			accessKeyId: ,
    			secretAccessKey: ,
   	 			"region": "us-east-1"   
				});

				var lambda = new AWS.Lambda({region: 'us-east-1', apiVersion: '2015-03-31'});
				var headerItem = document.getElementById('Welcome');
				headerItem.innerHTML = 'Welcome ' + name;
				var name = localStorage.getItem('username');
				var pass = localStorage.getItem('pass');

				function tooHigh(){

					var predictedLayers = localStorage.getItem('Layers');
					// aws call to reduce number  of layers
					var params = {
  					FunctionName : 'updatePrediction',
  					InvocationType : 'RequestResponse',
  					Payload: '{"Username":"' + name +'","Password":"' + pass +'","State":"' + state + '","City":"' + city +'","Layers":"' + (predictedLayers - 1).toString() + '"}',
  					LogType : 'None'
					};
					
					lambda.invoke(params, function(error, data) {
  					if (error) {
   						prompt(error);
  					} else {
    					// exec only if good
							if(data['StatusCode'] == 200){
								//print the results
								console.log(data);
							}else{
								alert("Failed ML Prediction");
							}
  					}
					});


					alert("Thank you.  Response recorded.");
				}

				function tooLow(){

					var predictedLayers = localStorage.getItem('Layers');
					//aws call to increase number of layers
					var params = {
  					FunctionName : 'updatePrediction',
  					InvocationType : 'RequestResponse',
  					Payload: '{"Username":"' + name +'","Password":"' + pass +'","State":"' + state + '","City":"' + city +'","Layers":"' + (predictedLayers + 1).toString() + '"}',
  					LogType : 'None'
					};
					
					lambda.invoke(params, function(error, data) {
  					if (error) {
   						prompt(error);
  					} else {
    					// exec only if good
							if(data['StatusCode'] == 200){
								//print the results
								console.log(data);
							}else{
								alert("Failed ML Prediction");
							}
  					}
					});
					alert("Thank you.  Response recorded.");
				}

				function switchLocation(){
					// ask for new location to update current suggestions
					var state = prompt("Please enter state abreviation. (MD)");
					var city = prompt("Please enter city.");

					localStorage.setItem('City', city);
					localStorage.setItem('State', state);
					// invoke aws services to verify user
					var params = {
  					FunctionName : 'predict',
  					InvocationType : 'RequestResponse',
  					Payload: '{"Username":"' + name +'","Password":"' + pass +'","State":"' + state + '","City":"' + city +'"}',
  					LogType : 'None'
					};
					
					lambda.invoke(params, function(error, data) {
  					if (error) {
   						prompt(error);
  					} else {
    					// exec only if good
							if(data['StatusCode'] == 200){
								//print the results
								console.log(data);

								//localeStorage.setItem('Layers', 2);
							}else{
								alert("Failed ML Prediction");
							}
  					}
					});
				}

				function logOut() {
					//switch back to home
					document.location.href = 'index.html';
				}
			</script>
		</div>
	</body>
</html>